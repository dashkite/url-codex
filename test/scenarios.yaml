url:
  - name: origin only
    url: https://acme.org
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]

  - name: origin and path
    url: https://acme.org/foo
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      path: [ foo ]

  - name: origin and query
    url: https://acme.org?foo=bar
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      query:
        - key: foo
          value: bar

  - name: origin, path, and query
    url: https://acme.org/foo/bar?baz=buzz
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      path: [ foo, bar ]
      query:
        - key: baz
          value: buzz

template:
  - name: origin only
    template: https://{subdomain}.acme.org
    expect:
      origin:
        protocol: https
        domain:
          - expression:
              variable: subdomain
          - acme
          - org

  - name: path
    template: https://acme.org/{foo}
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      path:
        - expression:
            variable: foo

  - name: path with modifier
    template: https://acme.org/{foo*}
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      path:
        - expression:
            modifier: "*"
            variable: foo

  - name: query
    template: https://acme.org?{foo}
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      query:
        - key: foo
          value:
            expression:
              variable: foo

  - name: query with modifier
    template: https://acme.org?{foo*}
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      query:
        - key: foo
          value:
            expression:
              modifier: "*"
              variable: foo

  - name: path and query
    template: https://acme.org/{foo}?{bar}
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      path:
        - expression:
            variable: foo
      query:
        - key: bar
          value:
            expression:
              variable: bar

  - name: path and query with modifiers
    template: https://acme.org/{foo*}?{bar*}
    expect:
      origin:
        protocol: https
        domain: [ acme, org ]
      path:
        - expression:
            modifier: "*"
            variable: foo
      query:
        - key: bar
          value:
            expression:
              modifier: "*"
              variable: bar


encode/decode:
  - name: simple path
    template: https://acme.org/{foo}
    url: https://acme.org/abc
    bindings:
      foo: abc

  - name: simple path with literal
    template: https://acme.org/foo/{bar}
    url: https://acme.org/foo/abc
    bindings:
      bar: abc


  - name: optional path (?)
    template: https://acme.org/{foo?}
    url: https://acme.org/abc
    bindings:
      foo: abc

  - name: optional path (?), no binding
    template: https://acme.org/{foo?}
    url: https://acme.org
    bindings:
      foo: ~

  - name: wildcard path (*)
    template: https://acme.org/{foo*}
    url: https://acme.org/abc/def
    bindings:
      foo: [ abc, def ]

  - name: wildcard path (*), no binding
    template: https://acme.org/{foo*}
    url: https://acme.org
    bindings:
      foo: []

  - name: wildcard path (+)
    template: https://acme.org/{foo+}
    url: https://acme.org/abc/def
    bindings:
      foo: [ abc, def ]

  - name: simple query
    template: https://acme.org/foo?{bar}
    url: https://acme.org/foo?bar=abc
    bindings:
      bar: abc

  - name: simple path and query
    template: https://acme.org/{foo}?{bar}
    url: https://acme.org/abc?bar=123
    bindings:
      foo: abc
      bar: "123"

  - name: optional query (?)
    template: https://acme.org/foo?{bar?}
    url: https://acme.org/foo?bar=abc
    bindings:
      bar: abc

  - name: optional query (?), no binding
    template: https://acme.org/foo?{bar?}
    url: https://acme.org/foo
    bindings:
      bar: ~

  - name: wildcard query (*)
    template: https://acme.org/foo?{bar*}
    url: https://acme.org/foo?bar=abc&bar=def
    bindings:
      bar: [ abc, def ]

match failure:

  - name: simple path, missing variable
    template: https://acme.org/foo/{bar}
    url: https://acme.org/foo

  - name: simple path, mismatched literal
    template: https://acme.org/foo/{bar}
    url: https://acme.org/baz

  - name: wildcard path (+), missing variable
    template: https://acme.org/{foo+}
    url: https://acme.org

  - name: simple query, mismatched literal
    template: https://acme.org/foo?{bar}
    url: https://acme.org/baz?bar=abc
